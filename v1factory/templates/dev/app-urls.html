{% extends "infra-html.html" %}

{% block css %}
    <link rel="stylesheet" type="text/css" href="{{ STATIC_URL }}css/reset.css">
    <link rel="stylesheet" type="text/css" href="{{ STATIC_URL }}css/website.css">
    <link rel="stylesheet" type="text/css" href="{{ STATIC_URL }}css/urls.css">
{% endblock %}

{% block topbar %}
<div class="row">
  <div class="offset2 toppanel span21 hi3">
  <h1 class="name hoff1"><a href="{% url v1factory.views.app_list %}">Heap Engine</a> | {{ title }}</h1>
  </div>
  <div class="span8 right hoff1 offsetr1">
    <a class="btn">Go back</a><a class="btn">Cancel</a><a class="btn" id="save-urls">Save</a>
  </div>
</div>
{% endblock %}

{% block page %}
<div class="container" id="urls-page">
  <div class="row top-buttons offset1 span30 tb-border">
    Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.
  </div>
  <div id="urls-editor">
    
  </div>
  <div class="row span30 offset1 hoff1">
    <div class="pane border add-url hi2" id="create-url">
      + Create a new URL
    </div>
  </div>
</div>
{% endblock %}

{% block js %}
<script type="text/html" id="template-url">

      <div class="pane hi2">
        <div class="span22 url">
        <% var endsWithEnt = 1;
           _.each(urls, function(url, i) { %>
          <span class="slash">/</span>
          
          <% if (/\{\{([^\}]+)}}/g.exec(url)) { endsWithEnt = 1 %>
          <select class="id url-part" id="inp-<%= i %>">
          <% _.each(entities, function(entity, i) { %>
            <option> <%= entity %> </option>
          <% }); %>
          </select>
          <% } else { endsWithEnt = 0; %>
          <input type="text" class="url-part" placeholder="url_string" id="inp-<%= i %>" value='<%= url %>'>
          <% } %>
        <% }); %>

        <% if(!endsWithEnt) {%>
          <span class="slash">/</span>
          <select class="id url-part last" id="inp-new" %>>
            <option>Add ID</option>
            <% _.each(entities, function(entity, i) { %>
              <option> <%= entity.name %> ID </option>
            <% }); %>
          </select>
        <% } else {%>
          <span class="slash">/</span>
          <input type="text" class="url-part last" id="inp-new" placeholder="url_string" value=''>
        <% } %>
        </div>
        <div class="pages span1 arrow">»</div>
        <div class="pages right span6 offset1">
          <select class="page">
            <% _.each(pages, function(page){ %>
            <option><%= page.name %></option>
            <% }); %>
            <option value="<<new_page>>">+ Create a new page</option>
          </select>
          <form class="add-page-form" style="display:none;">
            <input class="page-name-input">
          </form>
          <div class="cross right">×</div>
        </div>
      </div>
</script>
<script type="text/html" id="template-entity">
<span class="slash">/</span>
<select class="id url-part last" id="inp-new" %>>
  <option>Add ID</option>
  <% _.each(entities, function(entity, i) { %>
  <option> <%= entity %> </option>
  <% }); %>
</select>
</script>
<script type="text/html" id="template-text">
<span class="slash">/</span>
<input type="text" class="url-part last" id="inp-new" placeholder="url_string" value=''>
</script>
<script type="text/javascript">
  var appState = {{ app.state_json|safe }};
</script>
<script type="text/javascript" src="{{ STATIC_URL }}js/urls-editor.js"></script>
{% endblock %}
