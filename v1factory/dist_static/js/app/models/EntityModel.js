define(["require","app/collections/FieldsCollection","app/collections/FormCollection","backbone"],function(e){var t=e("app/collections/FieldsCollection"),n=e("app/collections/FormCollection"),r=e("backbone"),i=r.Model.extend({initialize:function(e){if(typeof e=="string"){if(e==="User"){alert("EntityModel init isnt supposed to receive user");return}e=_.findWhere(appState.entities,{name:e})}e.name?this.set("name",e.name):alert("Entity should have a name. Something is wrong."),this.set("fields",new t),e.fields&&this.get("fields").add(e.fields),this.set("forms",new n),e.forms&&this.get("forms").add(e.forms)},toJSON:function(){var e={};return e=_.clone(this.attributes),e.fields=this.get("fields").toJSON(),e.forms=this.get("forms").toJSON(),e},getFormWithName:function(e){var t=/\{\{([^\}]+)\}\}/g.exec(e)[1],n=this.get("forms").where({name:t})[0];return n}});return i});