define(["app/collections/ElementCollection"],function(e){var t=Backbone.View.extend({el:null,className:"elements-list",events:{},initialize:function(t,n){_.bindAll(this,"render","dropped"),this.entity=n,this.row=t,this.elementsCollection=new e(defaultElements),this.render()},render:function(){var e=this,t=document.createElement("ul");return t.className="section",this.el.appendChild(t),this.allList=t,this.appendContextEntity(this.entity),_(e.elementsCollection.models).each(function(t){e.appendElement(t)}),this.$el.find(".entity").draggable({cursor:"move",cursorAt:{top:0,left:0},helper:"clone",start:function(t){e.dragActive=!0},stop:e.dropped}),this.$el.find(".single-data").draggable({cursor:"move",cursorAt:{top:0,left:0},helper:"clone",start:function(t){e.dragActive=!0},stop:e.dropped}),this},appendContextEntity:function(e){var t=this;_(e.get("fields").models).each(function(n,r){var i={name:e.get("name"),cid:e.cid,attr:n.get("name"),type:n.get("type")};$(t.allList).append(_.template(Templates.tempLiSingleData,i))})},appendElement:function(e){var t=this,n=document.createElement("li");n.className=e.get("className"),n.innerHTML='<span class="name">'+e.get("text")+"</span>",$(this.allList).append(n),this.$el.find("."+e.get("className")).draggable({cursor:"move",cursorAt:{top:0,left:0},helper:function(t){return $(e.get("el")).css("position","fixed")},start:function(e){t.dragActive=!0},stop:t.dropped}),$(n).on("click",t.dropped)},dropped:function(e){var t=this,n={},r,i,s;this.dragActive=!1,r=0,i=1,n.layout={top:i,left:r};var o=e.target.className,u=e.target.id,a,f,l,c,h,p,d;n.context=this.entity.get("name");if(/(single-data)/.exec(o)){u=String(u).replace("entity-","");var v=u.split("-")[0];v===g_userModel.cid?h=new UserEntityModel(appState.users):h=g_entityCollection.get(v),d=u.split("-")[1],n=_.extend(n,uieState.texts[0]),n.content="{{loop."+h.get("name")+"."+d+"}}",this.row.get("uielements").push(n)}else{var m;m=o.replace(" ui-draggable",""),n=_.extend(n,uieState[m][0]),n.type=m,this.row.get("uielements").push(n)}}});return t});