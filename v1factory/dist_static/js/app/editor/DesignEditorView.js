define(["backbone","iui"],function(e,t){var n=e.Model.extend({}),r=e.Collection.extend({model:n}),i=e.View.extend({el:null,tagName:"div",className:"property hi6 hoff1 span5 offset1",initialize:function(e,t,n,r){_.bindAll(this,"render","renderTitle","style","select","amendAppState"),this.model=e,this.model.bind("change",this.amendAppState),this.options=designOptions[this.model.get("type")],this.options.currentValue=this.model.get("value"),this.pageModel=t,this.ind=n,this.shouldStyle=r||!0,this.render(),this.style()},render:function(){},renderTitle:function(){this.el.innerHTML="<h3>"+this.options.name+"</h3>"},style:function(){if(!this.pageModel.get("shouldStyle"))return;document.getElementById(this.options.id)&&$(document.getElementById(this.options.id)).remove();var e=document.createElement("style");e.id=this.options.id;var t=".page "+(this.options.tag||"")+", "+".class-picker "+(this.options.tag||"")+" {";t+=this.options.css.replace(/<%=content%>/g,this.model.get("value")),t+="}",e.innerHTML=t,this.styleTag=e,document.getElementsByTagName("head")[0].appendChild(e)},amendAppState:function(e){var t=this.pageModel.get("design_props");t[this.ind]=this.model.toJSON(),this.pageModel.set("design_props",t),this.style()}}),s=i.extend({events:{"click .color":"colorClicked","click .opt":"select","change .color":"selectColor"},initialize:function(e,t,n,r){this.constructor.__super__.initialize.apply(this,[e,t,n,r]),_.bindAll(this,"selectColor","colorClicked")},render:function(){var e=this;this.renderTitle();var t='<div class="options">';_(this.options.options).each(function(n,r){var i=e.model.get("value")==n?"selected":"";t+='<div class="opt '+i+'" id="color-'+r+'" style="background-color:'+n+';"></div>'}),t+='<div class="opt"><input class="color"></div>',t+="</div>",this.el.innerHTML+=t},select:function(e){e.preventDefault(),$(".opt",this.el).removeClass("selected"),$(e.target).addClass("selected");var t=String(e.target.id).replace("color-","");return this.selectColor(this.options.options[t]),!1},selectColor:function(e,t){if(!e.target)return!1;this.model.set("value","#"+e.target.value)},colorClicked:function(e){return e.preventDefault(),!1}}),o=i.extend({events:{"click .opt":"select"},render:function(){var e=this;this.renderTitle();var t='<div class="background options">';_(this.options.options).each(function(n){var r=e.model.get("value")==n?"selected":"";t+='<div class="opt '+r+'" style="background-image:'+n+'"></div>'}),t+="</div>",this.el.innerHTML+=t},select:function(e){e.preventDefault(),$(".opt",this.el).removeClass("selected"),$(e.target).addClass("selected");var t=e.target.style.backgroundImage;return this.model.set("value",t),!1}}),u=i.extend({className:"property hi6 hoff1 span1 offset1",events:{"change .size":"select"},render:function(){var e=this;this.renderTitle();var t='<div class="size options"><select>';_(this.options.options).each(function(n){var r=e.model.get("value")==n?"selected":"";t+="<option "+r+">"+n+"</option>"}),t+="</select></div>",this.el.innerHTML+=t},select:function(e){var t=e.target.value;return this.model.set("value",t),e.preventDefault(),!1}}),a=i.extend({className:"property hi6 hoff1 span4 offset1",events:{"change .size":"select"},render:function(){var e=this;this.renderTitle();var t='<div class="size options"><select class="font">';_(this.options.options).each(function(n,r){var i=e.model.get("value")==n?"selected":"";t+="<option"+i+' value ="'+r+'">'+n+"</option>"}),t+="</select></div>",this.el.innerHTML+=t},select:function(e){var t=e.target.value;return this.model.set("value",this.options.options[t]),e.preventDefault(),!1}}),f=e.View.extend({el:document.getElementById("page-settings"),tagName:"div",className:"props-pane",events:{},initialize:function(e,t){_.bindAll(this,"render","newProperty"),this.model=e,this.collection=new r,this.collection.bind("add",this.newProperty,this),this.model.set("shouldStyle",t),this.render()},render:function(){},newProperty:function(e){var t=e.get("type"),n=_.indexOf(this.collection.models,e),r;switch(t){case"background-color":case"text-color":case"header-color":r=new s(e,this.model,n);break;case"background-image":r=new o(e,this.model,n);break;case"header-size":case"text-size":r=new u(e,this.model,n);break;case"header-family":case"text-family":r=new a(e,this.model,n)}this.el.appendChild(r.el)}});return f});