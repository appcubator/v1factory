define(["editor/WidgetView","editor/WidgetContainerView","app/models/WidgetModel","backbone"],function(e,t,n){var r=Backbone.View.extend({el:$(".page"),widgetsContainer:document.getElementById("elements-container"),widgets:[],selectedEl:null,copiedEl:null,events:{},initialize:function(e,t,n){_.bindAll(this,"render","changed","placeWidget","placeContainer","style","copy","paste");var r=this;this.render(),this.widgetsCollection=e,this.widgetsCollection.bind("add",this.placeWidget),this.containersCollection=t,this.containersCollection.bind("add",this.placeContainer),this.widgetsCollection.bind("change",this.changed),this.widgetsCollection.bind("selected",this.containersCollection.unselectAll),this.containersCollection.bind("selected",this.widgetsCollection.unselectAll),n.uielements&&_(n.uielements).each(function(e){e.container_info?r.containersCollection.add(e,r.widgetsCollection):r.widgetsCollection.add(e)}),this.widgetsCollection.bind("change",function(){iui.askBeforeLeave()}),this.widgetsCollection.bind("add",function(){iui.askBeforeLeave()})},render:function(){this.widgetsContainer.innerHTML=""},placeWidget:function(t){var n=new e(t);t.isFullWidth()?iui.get("full-container").appendChild(n.el):this.widgetsContainer.appendChild(n.el),n.resizableAndDraggable()},placeContainer:function(e){var n=new t(e);e.isFullWidth()?iui.get("full-container").appendChild(n.el):this.widgetsContainer.appendChild(n.el),n.resizableAndDraggable()},style:function(e){_(e).each(function(e){document.getElementById("style-"+e.type)&&$(document.getElementById("style-"+e.type)).remove();var t=document.createElement("style");t.id="style-"+e.type;var n=""+(designOptions[e.type].tag||".sample")+" {";n+=designOptions[e.type].css.replace(/<%=content%>/g,e.value),n+="}",t.innerHTML=n,this.styleTag=t,document.getElementsByTagName("head")[0].appendChild(t)})},changed:function(e){this.selectedEl=e},copy:function(){return this.selectedEl?(this.copiedEl=this.selectedEl.toJSON(),!0):!1},paste:function(){if(this.copiedEl){this.copiedEl.layout.left+=this.copiedEl.layout.width;var e=new n(this.copiedEl);this.widgetsCollection.push(e)}}});return r});