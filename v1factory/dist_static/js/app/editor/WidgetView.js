define(["backbone","mixins/BackboneUI"],function(){var e=Backbone.UIView.extend({el:null,className:"pseudo-outline widget-wrapper",tagName:"div",widgetsContainer:null,selected:!1,editable:!1,editMode:!1,shadowElem:null,events:{click:"select","click .delete":"remove",keyDown:"keyHandler"},initialize:function(e){var t=this;_.bindAll(this,"render","renderElement","select","outlineSelected","changedWidth","changedHeight","changedValue","changedTop","changedLeft","changedText","changedType","changedStyle","changedSource","toggleFull","moving","moved","resizing","resized","staticsAdded","keyHandler"),this.model=e,this.render(),this.model.bind("change:selected",this.outlineSelected,this),this.model.bind("change:type",this.changedType,this),this.model.bind("change:class_name",this.changedType,this),this.model.bind("remove",this.remove,this),this.model.get("layout").bind("change:width",this.changedWidth,this),this.model.get("layout").bind("change:height",this.changedHeight,this),this.model.get("layout").bind("change:top",this.changedTop,this),this.model.get("layout").bind("change:left",this.changedLeft,this),this.model.get("layout").bind("change:isFull",this.toggleFull,this),this.model.get("layout").bind("change:alignment",this.changedAlignment,this),this.model.get("layout").bind("change",this.changedPadding,this),this.model.bind("change:content",this.changedText,this),this.model.get("content_attribs").bind("change:src",this.changedSource,this),this.model.get("content_attribs").bind("change:value",this.changedValue,this),this.model.get("content_attribs").bind("change:style",this.changedStyle,this),window.addEventListener("keydown",this.keyHandler)},render:function(){var e=this.model.get("layout").get("width"),t=this.model.get("layout").get("height");return this.setTop(GRID_HEIGHT*this.model.get("layout").get("top")),this.setLeft(GRID_WIDTH*this.model.get("layout").get("left")),this.setHeight(t*GRID_HEIGHT),this.el.className+=" span"+e,this.el.style.textAlign=this.model.get("layout").get("alignment"),this.el.innerHTML=this.renderElement(),this.el.id="widget-wrapper-"+this.model.cid,this.model.isFullWidth()&&this.switchOnFullWidth(),this.resizableAndDraggable(),this},renderElement:function(){var e=Templates.tempNode,t=_.clone(this.model.attributes);t.content_attribs=this.model.get("content_attribs").attributes;var n=_.template(e,{element:t});return n},select:function(e){this.el.style.zIndex=2e3,this.model.select(),e.stopPropagation()},outlineSelected:function(){this.model.get("selected")?($(this.el).addClass("selected"),this.el.style.zIndex=2e3,this.selected=!0):($(this.el).removeClass("selected"),this.selected=!1,this.el.style.zIndex="")},changedWidth:function(e){this.el.className="selected widget-wrapper ",this.el.className+="span"+this.model.get("layout").get("width"),this.setLeft(GRID_WIDTH*this.model.get("layout").get("left"))},changedAlignment:function(){this.el.style.textAlign=this.model.get("layout").get("alignment")},changedPadding:function(){this.el.style.paddingTop=this.model.get("layout").get("t-padding"),this.el.style.paddingBottom=this.model.get("layout").get("b-padding"),this.el.style.paddingLeft=this.model.get("layout").get("l-padding"),this.el.style.paddingRight=this.model.get("layout").get("r-padding")},toggleFull:function(e){this.model.get("layout").get("isFull")===!0?this.switchOnFullWidth():this.switchOffFullWidth()},switchOnFullWidth:function(){$("#full-container").append(this.el),this.disableResizeAndDraggable(),this.el.className="selected widget-wrapper spanFull",this.setLeft(0),this.fullWidth=!0},switchOffFullWidth:function(){this.fullWidth=!1,$("#elements-container").append(this.el),this.render()},changedHeight:function(e){this.setHeight(this.model.get("layout").get("height")*GRID_HEIGHT)},changedTop:function(e){this.setTop(GRID_HEIGHT*this.model.get("layout").get("top"))},changedLeft:function(e){this.setLeft(GRID_WIDTH*this.model.get("layout").get("left"))},changedText:function(e){this.el.firstChild.innerHTML=this.model.get("content")},changedValue:function(e){this.el.firstChild.value=this.model.get("content_attribs").get("value")},changedType:function(e){this.el.firstChild.className=this.model.get("class_name")},changedSource:function(e){this.el.firstChild.src=this.model.get("content_attribs").get("src")},changedStyle:function(){this.el.firstChild.setAttribute("style",this.model.get("content_attribs").get("style")),this.el.firstChild.style.lineHeight="1em"},resizing:function(e,t){var n=(t.size.height+2)/GRID_HEIGHT,r=(t.size.width+2)/GRID_WIDTH,i=Math.round((t.size.height+2)/GRID_HEIGHT),s=Math.round((t.size.width+2)/GRID_WIDTH);this.model.get("layout").set("width",s),this.model.get("layout").set("height",i)},resized:function(e,t){this.el.style.width="",this.el.style.height="",this.changedWidth(),this.changedHeight()},moving:function(e,t){var n=Math.round(t.position.top/GRID_HEIGHT),r=Math.round(t.position.left/GRID_WIDTH);this.model.get("layout").set("top",n),this.model.get("layout").set("left",r)},moved:function(e,t){this.el.style.left="",this.el.style.top="",this.changedLeft(),this.changedTop()},staticsAdded:function(e){_(e).each(function(e){e.name=e.filename,statics.push(e)}),this.model.get("content_attribs").set("src",_.last(e).url)},keyHandler:function(e){switch(e.keyCode){case 13:break;case 27:}return!1}});return e});