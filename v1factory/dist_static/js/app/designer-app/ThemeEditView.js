define(["app/designer-app/UIElementListView","app/models/PageDesignModel","iui","../templates/ThemeTemplates"],function(e,t){var n=Backbone.Model.extend({}),r=Backbone.Model.extend({}),i=Backbone.View.extend({el:document.body,events:{"click #save":"save","click .expandible":"expandSection","keyup #base-css":"baseChanged","click #create-page":"pageCreateClicked","submit .create-page-form":"pageCreateSubmitted","click #upload-static":"uploadStatic"},initialize:function(t){_.bindAll(this,"save","render","expandSection","baseChanged","pageCreateSubmitted","uploadStatic");var n=this;this.model=t,this.render();var r=new e(this.model.get("buttons"),"button");iui.get("button-cont").appendChild(r.el);var i=new e(this.model.get("images"),"image");iui.get("image-cont").appendChild(i.el);var s=new e(this.model.get("headerTexts"),"header-text");iui.get("header-text-cont").appendChild(s.el);var o=new e(this.model.get("texts"),"text");iui.get("text-cont").appendChild(o.el);var u=new e(this.model.get("links"),"link");iui.get("link-cont").appendChild(u.el);var a=new e(this.model.get("textInputs"),"text-input");iui.get("text-input-cont").appendChild(a.el);var f=new e(this.model.get("passwords"),"password");iui.get("password-cont").appendChild(f.el);var l=new e(this.model.get("textAreas"),"text-area");iui.get("text-area-cont").appendChild(l.el);var c=new e(this.model.get("lines"),"line");iui.get("line-cont").appendChild(c.el);var h=new e(this.model.get("dropdowns"),"dropdown");iui.get("dropdown-cont").appendChild(h.el);var p=new e(this.model.get("boxes"),"box");iui.get("box-cont").appendChild(p.el),this.model.get("pages").bind("add",this.renderPage)},render:function(){var e=this;this.editor=ace.edit("base-css"),this.editor.getSession().setMode("ace/mode/css"),this.editor.setValue(this.model.get("basecss")),_(this.model.get("pages").models).each(function(t,n){e.renderPage(t,n)}),_(statics).each(function(e){iui.get("statics-cont").innerHTML+='<img width="100" src="'+e.url+'">'+e.name})},baseChanged:function(e){var t=this.editor.getValue(),n=/body \{([^\}]+)\}/g,r=/margin:([^;]+);/g,i=/height:([^;]+);/g,s=/position:([^;]+);/g,o=/width:([^;]+);/g,u=/overflow-x:([^;]+);/g,a=n.exec(t)[0],f;f=a.replace(i,""),f=f.replace(r,""),f=f.replace(s,""),f=f.replace(o,""),f=f.replace(u,""),t=t.replace(a,f),this.model.set("basecss",t)},renderPage:function(e,t){var n=iui.get("pages-list"),r=t;t===null&&(r=this.model.get("pages").models.length),typeof r!="number"&&(r=r.models.length-1),n.innerHTML+='<li><a href="/theme/'+themeId+"/editor/"+r+'">'+e.get("name")+"</a></li>"},expandSection:function(e){$(".expanded").removeClass("expanded"),$("#"+e.target.parentNode.id+"-cont").addClass("expanded")},pageCreateClicked:function(e){$(e.target).hide(),$(".create-page-form").fadeIn(),$(".create-page-name").focus()},pageCreateSubmitted:function(e){e.preventDefault();var n=$(".create-page-name").val(),r=new t({name:n});$(".create-page-name").val(""),this.model.get("pages").add(r),$(".create-page-form").hide(),$("#create-page").fadeIn()},uploadStatic:function(){var e=this;iui.openThemeFilePick(e.staticsAdded,e,themeId)},staticsAdded:function(e,t){},save:function(){var e=_.clone(this.model.attributes);console.log(this.model.get("links").toJSON()),e.buttons=this.model.get("buttons").toJSON(),e.images=this.model.get("images").toJSON(),e.headerTexts=this.model.get("headerTexts").toJSON(),e.texts=this.model.get("texts").toJSON(),e.links=this.model.get("links").toJSON(),e.textInputs=this.model.get("textInputs").toJSON(),e.passwords=this.model.get("passwords").toJSON(),e.textAreas=this.model.get("textAreas").toJSON(),e.lines=this.model.get("lines").toJSON(),e.dropdowns=this.model.get("dropdowns").toJSON(),e.boxes=this.model.get("boxes").toJSON(),console.log(e),$.ajax({type:"POST",url:"/theme/"+themeId+"/edit/",data:{uie_state:JSON.stringify(e)},success:function(){},dataType:"JSON"})}});return i});