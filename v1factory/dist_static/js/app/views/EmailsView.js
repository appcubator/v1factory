define(["app/collections/EmailCollection","app/models/EmailModel"],function(e,t){var n=Backbone.View.extend({el:document.body,events:{"click #create-email":"createEmail","click .email-display":"clickedEmail","keyup .email-name-input":"emailNameChanged","keyup .email-subject-input":"emailSubjectChanged","keyup .email-content-input":"emailContentChanged"},initialize:function(){_.bindAll(this,"render","appendEmail","clickedEmail","displayEmail","createEmail","emailNameChanged","emailSubjectChanged","emailContentChanged","saveEmails"),this.collection=new e(appState.emails||[]),this.collection.bind("add",this.appendEmail,this),this.listView=document.getElementById("email-list"),this.render(),this.collection.bind("add",this.displayEmail),$("#save-emails").on("click",this.saveEmails)},render:function(){var e=this;return _(e.collection.models).each(function(t){e.appendEmail(t)}),this},clickedEmail:function(e){var t=(e.target.id||e.target.parentNode.id).replace("email-",""),n=this.collection.get(t);this.displayEmail(n)},displayEmail:function(e){this.$el.find(".email-name-input").val(e.get("name")).attr("id","email-inp-"+e.cid),this.$el.find(".email-subject-input").val(e.get("subject")).attr("id","email-inp-"+e.cid),this.$el.find(".email-content-input").val(e.get("content")).attr("id","email-inp-"+e.cid)},createEmail:function(e){var n=new t;this.collection.push(n)},appendEmail:function(e){this.listView.innerHTML+='<li id="email-'+e.cid+'" class="email-display"><h3>'+e.get("name")+"</h3></li>"},emailNameChanged:function(e){var t=e.target.id.replace("email-inp-","");this.collection.get(t).set("name",e.target.value),$("#email-"+t).html("<h3>"+e.target.value+"</h3>")},emailSubjectChanged:function(e){var t=e.target.id.replace("email-inp-","");this.collection.get(t).set("subject",e.target.value)},emailContentChanged:function(e){var t=e.target.id.replace("email-inp-","");this.collection.get(t).set("content",e.target.value)},saveEmails:function(e){appState.emails=this.collection.toJSON(),$.ajax({type:"POST",url:"/app/"+appId+"/state/",data:JSON.stringify(appState),success:function(){},dataType:"JSON"})}});return n});