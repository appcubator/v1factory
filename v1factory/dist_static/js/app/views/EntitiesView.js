define(["app/models/EntityModel","app/models/UserEntityModel","app/models/FieldModel","app/views/UploadExcelView","app/views/ShowDataView","app/views/EntityView","app/views/UserEntityView","app/collections/EntityCollection","backbone","jquery-ui"],function(e,t,n,r,i,s,o,u){var a=Backbone.View.extend({el:$("#entities"),initialize:function(e){_.bindAll(this,"render","appendItem");var n=this,r=appState.entities||[];this.render(),this.collection=e,this.collection.bind("add",this.appendItem),this.collection.add(r),this.userModel=new t(appState.users),new o(this.userModel,this.collection),this.collection.trigger("initialized")},render:function(){},appendItem:function(e){var t=new s(e,"entity-list-",this.collection);this.el.appendChild(t.el)}}),f=Backbone.View.extend({el:document.body,addButton:$("#add-entity-button"),addForm:$("#add-entity-form"),events:{"click #save-entities":"saveEntities","click #add-entity-button":"clickedAdd","submit #add-entity-form":"formSubmitted"},initialize:function(){_.bindAll(this,"render","clickedAdd","formSubmitted","saveEntities"),this.collection=new u,this.entityList=new a(this.collection)},render:function(){},clickedAdd:function(e){var t=this.addForm.clone();$(t).appendTo("#entities"),$(t).fadeIn(),$(this.addButton).hide(),$("#entity-name-input").focus()},formSubmitted:function(e){e.preventDefault();var t={};t.name=$("#entity-name-input").val(),t.fields=[],this.collection.add(t),$("#entity-name-input").val(""),$(this.addButton).fadeIn(),$(e.target).remove()},saveEntities:function(e){appState.entities=this.collection.toJSON(),appState.users=this.entityList.userModel.toJSON(),$.ajax({type:"POST",url:"/app/"+appId+"/state/",data:JSON.stringify(appState),success:function(){},dataType:"JSON"})}});return f});