define(["mixins/BackboneModal","app/templates/UrlTemplates"],function(){var e=Backbone.ModalView.extend({events:{"change .url-part":"urlPartChanged","change .page":"pageChanged","click .cross":"urlRemoved","change .last":"lastEntityChanged","keypress .last":"lastTextChanged"},initialize:function(e){var t=this;_.bindAll(this,"urlPartChanged","pageChanged","urlRemoved","lastEntityChanged","lastTextChanged"),this.model=e,this.model.get("urlparts")||this.model.set("urlparts",[]),this.render()},render:function(){var e=UrlTemplate.mainTemplate,t=_.template(e,{urls:this.model.get("urlparts"),entities:appState.entities,pages:appState.pages,page_name:this.model.get("page_name")});return this.el.innerHTML=t,this},urlPartChanged:function(e){if(e.target.id=="inp-new"){e.target.id="inp-"+this.model.get("urlparts").length;var t=e.target.value;e.target.tagName=="SELECT"&&(t="{{"+t+"}}"),this.model.get("urlparts").push(t)}else{var n=String(e.target.id).replace("inp-","");this.model.get("urlparts")[n]=e.target.value}},pageChanged:function(e){if(e.target.value=="<<new_page>>"){$(e.target).hide(),$(".add-page-form",this.el).fadeIn(),$(".page-name-input",this.el).focus();return}this.model.set("page_name",e.target.value)},urlRemoved:function(){this.model.destroy(),this.remove()},lastEntityChanged:function(e){$(e.target).removeClass("last");var t=UrlTemplate.templateText,n=_.template(t,{urls:this.urlParts,entities:appState.entities,pages:appState.pages});$(".url",this.el).append(n)},lastTextChanged:function(e){$(e.target).removeClass("last");var t=UrlTemplate.templateEntity,n=_.template(t,{urls:this.urlParts,entities:appState.entities,pages:appState.pages});$(".url",this.el).append(n)}});return e});