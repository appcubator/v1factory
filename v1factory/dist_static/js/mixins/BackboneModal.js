define(["backbone","jquery-ui"],function(e){return e.ModalView=e.View.extend({width:500,padding:30,events:{"click .modal-bg":"closeModal",keydown:"handleKey"},_configure:function(t){e.ModalView.__super__._configure.call(this,t),this.backgroundDiv=this.setupModal(),this.modalWindow=this.setupModalWindow(),_.bindAll(this,"closeModal","handleKey")},_ensureElement:function(t){e.ModalView.__super__._ensureElement.call(this,t)},setupModal:function(){var e=this,t=document.createElement("div");return t.className="modal-bg fadeIn",t.style.position="fixed",t.style.width="100%",t.style.height="100%",t.style.top="0",t.style.left="0",t.style.backgroundColor="#222",t.style.opacity="0.6",t.style.zIndex=3e3,document.body.appendChild(t),$(t).on("click",function(){e.closeModal()}),$(window).on("keydown",function(t){t.keyCode==27&&e.closeModal()}),t},setupModalWindow:function(){var e=this,t=document.createElement("div");t.style.position="fixed",t.className="modal "+this.className,t.style.width=this.width+"px",t.style.minHeight="300px",this.height&&(t.style.height=this.height),t.style.top="50%",t.style.left="50%",t.style.marginLeft="-"+this.width/2+"px",t.style.marginTop="-300px",t.style.padding=this.padding+"px",t.style.zIndex=3001;var n=document.createElement("span");n.className="modal-cross",n.style.position="absolute",n.style.right="15px",n.style.top="15px",n.innerText="Ã—",t.appendChild(n);var r=document.createElement("div");return r.style.width="100%",t.appendChild(r),document.body.appendChild(t),$(n).on("click",function(){e.closeModal()}),this.el=r,t},closeModal:function(){var e=this;this.undelegateEvents(),this.callback&&this.callback(),this.onClose&&this.onClose(),$(e.modalWindow).fadeOut(100),$(e.backgroundDiv).hide(),setTimeout(function(){e.$el.remove(),e.remove(),$(e.modalWindow).remove(),$(e.backgroundDiv).remove()},550),this.stopListening()},handleKey:function(e){e.keyCode==27&&(this.closeModal(),e.stopPropagation())}}),e});